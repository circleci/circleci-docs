= システム要件
:page-layout: classic-docs
:page-liquid:
:icons: font
:toc: macro
:toc-title:
:sectanchors:

ここでは、CircleCI v{serverversion}-beta をインストールするためのシステム要件およびポート アクセス要件について説明します。

toc::[]

== Kubernetes クラスタ

Kubernetes クラスタには、ユーザー向けの Web サイト、API エンジン、データストア、Nomad ジョブ スケジューラなど、CircleCI Server 製品のコア コンポーネントがホスティングされます。

CPU、RAM、ディスク容量の要件は以下の表のとおりです。

[.table.table-striped]
[cols=5*, options="header", stripes=even]
|===
| 1 日の CircleCI アクティブ ユーザー数
| 最小ノード数
| 合計 CPU
| 合計 RAM
| NIC 速度

| 500 以下
| 3
| 24
| 120GB
| 1Gbps

| 501 以上
| 3
| 48 コア
| 240GB
| 10Gbps

|===

== Nomad クライアント

CircleCI のジョブは、Nomad クライアント マシンで実行され、Nomad サーバーでスケジュールが管理されます。各クライアントに推奨される CPU、RAM、ディスク容量の最小要件は、以下のとおりです。

- CPU: vCPU 8 基 (2.4GHz、4 コア以上)
- RAM: 32GB
- ディスク容量: 100GB
- NIC 速度: 1Gbps

各クライアントでより多くのジョブに対応できるよう、大きいインスタンス タイプを選択することもできます。選択の目安として、Nomad ではクライアントがジョブに適しているかどうかを判断する際に 1024MHz の CPU と `コア数` * `クロック速度` の式で得られるディスク容量にジョブが割り当てられることを参考にするとよいでしょう。この計算式に基づくと、上記の仕様のインスタンスでは最大容量が `19200MHz` になります。つまり、このクライアントでは 9.6 個のジョブを実行できることになります (制限要因がない場合)。実際には、Nomad 自身のために CPU リソースがいくらか予約されます。また、CPU と RAM の比率から使用できる RAM が限られ、これも実行可能なジョブ数の制限要因になります。

Nomad クライアント数のベスト プラクティスを以下の表にまとめました。実際のシステムでの需要に合わせて、Nomad クライアント数を増減させてください。

[.table.table-striped]
[cols=2*, options="header", stripes=even]
|===
| 1 日の CircleCI アクティブ ユーザー数
| Nomad クライアント マシン数

| 50 未満
| 1 ～ 5

| 50 以上 250 未満
| 5 ～ 10

| 250 以上 1,000 未満
| 10 ～ 15

| 5,000 以上
| 15 以上
|===

== サーバー ポート

CircleCI Server v{serverversion}-beta のインストールで必要となるすべてのポートを、マシン タイプごとに以下の表に示します。

=== 外部ポート

CircleCI Server v{serverversion}-beta にアクセスするために必要なポートは以下のとおりです。 

[.table.table-striped]
[cols=6*, options="header", stripes=even]
|===
| **ポート番号**
| **プロトコル**
| **方向**
| **送信元/送信先**
| **用途**
| **備考**

| 80
| TCP
| インバウンド
| エンド ユーザー
| HTTP Web アプリ トラフィック
|

| 443
| TCP
| インバウンド
| エンド ユーザー
| HTTPS Web アプリ トラフィック
|

| 8800
| TCP
| インバウンド
| 管理者
| 管理者コンソール
|

| 22
| TCP
| インバウンド
| 管理者
| SSH
| 踏み台ホストでのみ必要

| 64535 ～ 65535
| TCP
| インバウンド
| エンド ユーザー
| ビルドへの SSH 接続機能
| Nomad クライアントでのみ必要

|===

外部サービスを使用する場合は、ポートの設定でインバウンドとアウトバウンドの両方を許可する必要がある点に注意してください。

=== Nomad クライアント
以下は、Nomad クライアントが Kubernetes クラスタと同じ VPC にない場合にのみ必要になります。

[.table.table-striped]
[cols=6*, options="header", stripes=even]
|===
| **ポート番号**
| **プロトコル**
| **方向**
| **送信元/送信先**
| **用途**
| **備考**


| 80
| TCP
| インバウンド
| 管理者
| CircleCI 管理者 API アクセス
|

| 443
| TCP
| インバウンド
| 管理者
| CircleCI 管理者 API アクセス
|

| 22
| TCP
| インバウンド
| 管理者
| SSH
|

| 22
| TCP
| アウトバウンド
| GitHub Enterprise/GitHub.com (該当するもの)
| GitHub からのコードのダウンロード
|

| 4647
| TCP
| 双方向
| Services マシン
| 内部通信
|

| 8585
| TCP
| 双方向
| Services マシン
| 内部通信
|

| 7171
| TCP
| 双方向
| Services マシン
| 内部通信
|

| 3001
| TCP
| 双方向
| Services マシン
| 内部通信
|

| 443
| TCP
| アウトバウンド
| クラウド ストレージ プロバイダー
| アーティファクト ストレージ
| 外部アーティファクト ストレージを使用する場合のみ

| 53
| UDP
| アウトバウンド
| 内部 DNS サーバー
| DNS 解決
| 処理に必要なすべての DNS 名をジョブで確実に解決できるようにするため
|===

