---

contentTags:
  platform:
  - Server v4.1
  - サーバー管理者
---
= values.yaml のサンプル
:page-layout: classic-docs
:page-liquid:
:page-description: エアギャップ環境への CircleCI Server をインストールする際の参考として、values.yaml ファイルのサンプルを紹介します。
:icons: font
:experimental:

次のスニペットは、CircleCIサーバーをエアギャップ環境でHelmインストールした場合の`values.yaml`ファイルの例である。

[#resources]
== リソース:

この図は、以下のリソースがある環境を想定しています：

- ヘルムチャート設置用のK3sクラスター
- イングレス用にK3sクラスタ上で事前に設定されたMetalLB
- docker.internal.example.comのプライベートdockerレジストリがポート5000でTLS暗号化なしで動作しています。
- mTLSを無効にしたNomadインスタンス
- minio.internal.example.comで実行されているMinIOインスタンスで、そのAPIはポート9000でリッスンしており、TLSは使用していません。
- server.internal.example.com`と`*.server.internal.example.com``の両方のドメインに対して発行されたTLS証明書。

特定の値の詳細については、xref:../installation/phase-2-core-services#[フェーズ 2 - コアサービス] で始まる標準インストール文書を参照してください。

[#values]
== リソース

[source, yaml]
----

# Private docker registry at docker.internal.example.com:5000
global:
  domainName: "server.internal.example.com"
  license: '<<your-server-license-here>>'
  container:
    registry: "docker.internal.example.com:5000"
    org: "<image-registry-org>"

# GitHub Enterprise
github:
  hostname: "github.internal.example.com"
  unsafeDisableWebhookSSLVerification: true # If using self-signed certificates
  enterprise: true
  selfSignedCert: true # If using self-signed certificates
  # These must be generated and added manually from GitHub Enterprise
  clientId: "<<github-enterprise-oauth-app-client-id>>"
  clientSecret: "<<github-enterprise-oauth-app-client-secret>>"
  defaultToken: "<<github-enterprise-personal-application-token>>"

# TLS with your provider
tls:
  certificate: "<<your-generated-tls-certificate>>"
  privateKey: "<<your-generated-tls-private-key>>"

# Object storage with Minio
object_storage:
  bucketName: "circleci-data" # Update to the name of the bucket created in MinIO
  expireAfter: 0
  s3:
    enabled: true
    endpoint: "http://minio.internal.example.com:9000"
    accessKey: "<<minio-username>>"
    secretKey: "<<minio-password>>"

# Distributor using CircleCI Agent in Minio
distributor:
  agent_base_url: http://minio.internal.example.com:9000/circleci-data
  launch_agent_base_url: http://minio.internal.example.com:9000/circleci-data

# Nomad
nomad:
  buildAgentImage: "docker.internal.example.com:5000/circleci/picard" # Do not provide image version, only image name and registry
  server:
    gossip:
      encryption:
        key: "<<nomad-gossip-encryption-key>>"
    rpc:
      mTLS:
        enabled: false # mTLS is disabled - it is recommended that this be enabled


# VM Service Disabled - Requires cloud connectivity
vm_service:
  enabled: false

# Additional nginx annotations
nginx:
  annotations:
    # This example uses MetalLB as a k3s load balancer
    metallb.universe.tf/allow-shared-ip: default

# The below values require no special modifications for an air-gapped environment

apiToken: "<<circleci-api-token>>"

sessionCookieKey: "<<circleci-session-cookie-key>>"

keyset:
  signing: '<<circleci-signing-key>>'
  encryption: '<<circleci-encryption-key>>'

mongodb:
  auth:
    rootPassword: "<<mongodb-root-password>>"
    password: "<<mongodb-password>>"

pusher:
  secret: "<<pusher-secret>>"

postgresql:
  auth:
    postgresPassword: "<<postgres-password>>"

rabbitmq:
  auth:
    password: "<<rabbitmq-password>>"
    erlangCookie: "<<rabbitmq-erlang-cookie>>"

----