---
contentTags:
  platform:
  - Cloud
---
= Set up CircleCI releases
:page-layout: classic-docs
:page-liquid:
:page-description: Tutorial outlining how to set up CircleCI releases, covering creating an environment integration, installing the release agent and creating components.
:icons: font
:experimental:

Visualise and control deployments to your Kubernetes cluster or SageMaker service with CircleCI releases. The steps outlined on this page guide you to set up CircleCI releases using the CircleCI web app onboarding process. If you would rather get set up manually, see #ADD LINK TO NEW PAGE FOR MANUAL RELEASE AGENT SETUP#

[#introduction]
== Introduction

In this tutorial you will set up an integration between CircleCI and your environment (Kubernetes cluster or SageMaker). Once configured, release status can be reported to the CircleCI web app, and the following commands can be executed in your cluster by the release agent via controls in the CircleCI UI:

* Restore a version
* Scale a version
* Restart a version
* Retry a release (when using Argo Rollouts)
* Promote a release (when using Argo Rollouts)
* Cancel a release (when using Argo Rollouts)

[#prerequisites]
== Prerequisites

Before setting up your environment integration with CircleCI, run through the following prerequisites:

* A CircleCI account connected to your code. You can link:https://circleci.com/signup/[sign up for free].
* A Kubernetes cluster or Amazon SageMaker service
* A project building on CircleCI that deploys to your Kubernetes cluster or SageMaker service. See the xref:../create-project#[Create a project] page for steps.
* You must have write access to the project associated with the component being deployed. For full details of roles and permissions for GitLab and GitHub App integrations, see the xref:../roles-and-permissions-overview.adoc#[Roles and permissions overview]. If your integration is through Bitbucket or the GitHub OAuth app, you will need to be an org admin in Bitbucket/GitHub respectively. To find out which GitHub integration you have, see the xref:../github-apps-integration.adoc#[GitHub App integration] page.

The following versions of Kubernetes, Helm, and Argo Rollouts have been tested and proven to work. Older versions may work but are not guaranteed:

{% include snippets/release/supported-versions.adoc %}

== Set up releases

[.tab.environmentintegration.Kubernetes_cluster]
--
. In the CircleCI web app, select **Releases** in the sidebar.
. If this is your first environment setup, select btn:[Create your first Environment Integration]. If you already have environments set up, choose the **Environments** tab and select btn:[Create Environment Integration].
. Enter a name for your environment, and a description if you would like.
. Use the dropdown menu to choose your environment integration type, Kubernetes cluster, then select btn:[Next: Release Agent Setup].
. To set up the release agent into your cluster and set up your components, follow the in-app setup steps. If you would rather continue the setup process manually, see the xref:set-up-the-release-agent#[Set up the release agent] page.

After completing all the steps you will have done the following:

* Set up an environment integration
* Installed the release agent into your Kubernetes cluster
* Configured your Kubernetes components.

Alternatively, you can choose to follow along the steps outlined below.
--

[.tab.environmentintegration.Amazon_SageMaker]
--
. In the CircleCI web app, select **Releases** in the sidebar.
. If this is your first environment setup, select btn:[Create your first Environment Integration]. If you already have environments set up, choose the **Environments** tab and select btn:[Create Environment Integration].
. Enter a name for your environment, and a description if you would like.
. Use the dropdown menu to choose your environment integration type, Amazon SageMaker, then select btn:[Save and Continue].
. To get set up with Amazon SageMaker from this point, follow the xref:../deploy-to-amazon-sagemaker#[Deploy to Amazon SageMaker] page.
--


[#add-release-agent]
== Manual installation

=== 2. Add the release agent into your Kubernetes cluster

Use Helm to install the CircleCI release agent into your Kubernetes cluster

. Add the link:https://circleci-public.github.io/cci-k8s-release-agent/[CircleCI release agent Helm repository] by running the following command:
+
[,shell]
----
helm repo add release-agent https://circleci-public.github.io/cci-k8s-release-agent
----

. Then, update your local Helm chart repository cache
+
[,shell]
----
helm repo update
----

[#install-the-release-agent]
=== 3. Install the release agent

Install the Helm chart to integrate CircleCI's release agent into your Kubernetes cluster.

You will need a `CCI_INTEGRATION_TOKEN` for the next step.
. Navigate to the `Environments` tab.
. Select the `gear` icon corresponding to the environment you just created to enter the `Environment Integration Settings` page.
. Select btn:[Create Integration Token] and then btn:[Create Token]
. The new token will be displayed. Be sure to copy and save this somewhere for use in the next step. Then select btn:[Done]

If required, include a list of Kubernetes namespaces you want to monitor. If you only want to monitor the `default` namespace, you do not need to supply a list with `--set manageNamespaces="{namespace1,namespace2}"`. The `default` namespace is monitored by default. If you struggle to pass the `manageNamespaces` value, try enclosing the array value or the whole parameter itself in a string, with double or single quotes.

[,shell]
----
helm upgrade --install circleci-release-agent-system release-agent/circleci-release-agent \
--set tokenSecret.token=[YOUR_CCI_INTEGRATION_TOKEN] --create-namespace \
--namespace circleci-release-agent-system \
--set managedNamespaces="{namespace1,namespace2}"
----

NOTE: You can further customize the agent installation and check all available options link:https://circleci-public.github.io/cci-k8s-release-agent/[here].

Once you have run this command, you can check your environment is set up by navigating to the environment details page to check the "last used" date has been populated:

. Select btn:[Releases] in the CircleCI web app sidebar.
. Select btn:[Configure Environments] at the top left of the page.
. Select the name of your release environment to view the environment details page.

[#next-steps]
== Next steps

In this tutorial you have integrated your Kubernetes cluster with CircleCI. You can now:

* xref:configure-your-kubernetes-components#[Configure your Kubernetes components].
* Learn how to xref:update-the-kubernetes-release-agent#[update the Kubernetes release agent]
