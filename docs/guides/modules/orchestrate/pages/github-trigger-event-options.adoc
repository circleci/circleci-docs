= GitHub trigger event options
:page-platform: Cloud
:page-description: A guide to the options available for triggering GitHub App pipelines. Trigger pipelines on non-push events.
:experimental:

When you create a trigger for a GitHub App pipeline, you can choose from a set of trigger options that are based on link:https://docs.github.com/en/webhooks/webhook-events-and-payloads[GitHub App events] and their properties. Using GitHub App trigger options you can trigger pipeline on non-push events.

== Introduction

CircleCI projects have pipelines and triggers.

* Pipelines define the various CI/CD 'units' of work that make up your project.
* Triggers define when and how to initiate a pipeline.

Configure triggers under menu:Project settings[Project Setup]. You can configure triggers to initiate pipelines on a variety of events. This page focuses on events from GitHub, but you can find the full list of events that can trigger a pipeline on the xref:triggers-overview.adoc[Trigger a pipeline] page.

For a full list of GitHub trigger event options, see <<supported-trigger-options>>.

.Trigger options under Project settings
image::guides:ROOT:triggers/select-when-to-run.png[Set a trigger option for a project trigger]

When you create or set up a project in CircleCI you will set up your first pipeline and trigger. This first trigger is, by default, an "all push" trigger, which corresponds to the link:https://docs.github.com/en/webhooks/webhook-events-and-payloads#push[GitHub App push event].

include::ROOT:partial$tips/check-github-type-org.adoc[]

If your CircleCI organization is integrated with GitHub only through the **GitHub App**, you will see trigger options when creating a project in the CircleCI web app. You have the option to change the trigger options for your first trigger when setting the project up. You can also set up additional triggers during project creation, or setup/edit later in your menu:Project settings[Project Setup].

.Trigger options during project creation
image::guides:ROOT:triggers/create-project-run-on.png[Create a project trigger and access trigger options]

If your CircleCI org is integrated via **GitHub OAuth** (see tip above), you can configure new triggers and optionally remove the existing OAuth trigger through menu:Project settings[Project Setup].

== Supported trigger options

****
Regardless of your chosen trigger option, CircleCI will **never** trigger a pipeline for the following:

* On branch or tag deletion push events.

GitHub App pipelines are also never triggered on the following:

* When a new branch is created if there are no new commits on the branch.
****

GitHub App triggers allow you to define the work to do (pipeline) when an event takes place (trigger). GitHub App triggers are an orchestration tool available in CircleCI. You can access GitHub App trigger options using the "Run on" menu when setting up a trigger. The following preset trigger options are available:

* *All pushes*: Trigger your pipeline on all pushes to your repo. All pushes corresponds to the link:https://docs.github.com/en/webhooks/webhook-events-and-payloads#push[GitHub App push event]. No pipelines are triggered on push events when a branch or tag are deleted. No pipeline is triggered when a branch is created.
* *Tag pushes*: Trigger a pipeline on pushes to tags only. When choosing this option, you will also need to link:https://circleci.com/docs/workflows/#executing-workflows-for-a-git-tag[define tag filters in your config file].
* *Pushes to default branch*: Trigger a pipeline on pushes to the default branch only.
* *PR opened or pushed to, default branch and tag pushes*: Trigger a pipeline on pushes to a branch for which there is an open Pull Request (PR), when a PR is opened, pushes to any tag, and pushes to the default branch. This applies also if the PR is re-opened after being closed.
* *PR opened*: Trigger a pipeline when a PR is opened. This applies also if the PR has been opened in draft. It does not apply if the PR is closed and then re-opened. See the link:https://docs.github.com/en/webhooks/webhook-events-and-payloads?actionType=opened#pull_request[GitHub docs for the pull request opened event].
* *PR merged*: Trigger a pipeline when a PR is merged only. See the link:https://docs.github.com/en/webhooks/webhook-events-and-payloads?actionType=closed#pull_request[GitHub docs for pull request closed].
* *PR merged or closed*: Trigger a pipeline when a PR is merged or closed. When this option is selected, pipelines will run by default on the _base_ branch on the pull request, not on the _head_ branch.
* *PR marked ready for review*: Trigger a pipeline when a PR is taken out of draft mode and marked ready for review. See the link:https://docs.github.com/en/webhooks/webhook-events-and-payloads?actionType=review_requested#pull_request[GitHub docs for pull request review requested].
* *"run-ci" label added to PR*: Trigger a pipeline when a label "run-ci" is added to a PR. See the link:https://docs.github.com/en/webhooks/webhook-events-and-payloads?actionType=labeled#pull_request[GitHub docs for pull request labelled].
* *Pushes to open non-draft PRs*: Trigger a pipeline when there is a push to a branch with an open PR that is not in draft mode.

NOTE: **Forked pull requests** never trigger GitHub App pipelines.

****
*Help us prioritize additional trigger options?* We are working to expand the available events and conditions for you to choose from. Let us know which additional triggers your team needs by filling out link:https://forms.gle/j7DC78CQNRmSBn159[this form].
****

The following two pipeline values are available for all GitHub App pipelines. Use these values to further configure your workflows and jobs to run on specific events:

* `pipeline.event.name`
* `pipeline.event.action`

The available GitHub App options for these values are listed in the following table:

[cols=3*, options="header"]
|===
|Trigger type
|`pipeline.event.name`
|`pipeline.event.action`

|GitHub push
|`push`
|`push`

|GitHub pull request
|`pull_request`
a| * `opened`
* `synchronize`
* `reopened`
* `closed`
* `ready_for_review`
* `labeled`

|===

All pipelines triggered by link:https://docs.github.com/en/webhooks/webhook-events-and-payloads#pull_request[pull request events] also have the following xref:reference:ROOT:variables.adoc#pipeline-values[pipeline values] populated:

[NOTE]
====
If your config contains a logical statement referencing any of the following pipeline values, you must either:

* Ensure your triggers only allow pull request related events.
* Include a condition to ensure that the pipeline runs for pull request related events: `pipeline.event.name == "pull_request"`.
====

[cols=".^1,1"]
|===
|Pipeline value |Description

|`pipeline.event.github.pull_request.base.ref`
|The name of the *base* (or target) branch of the PR - that is the branch that will receive the changes.

|`pipeline.event.github.pull_request.head.ref`
|The name of the *head* branch of the PR - that is the branch containing the changes to be merged.

|`pipeline.event.github.pull_request.draft`
|A boolean value indicating whether the pull request is a draft.

|`pipeline.event.github.pull_request.title`
|The title of the pull request.

|`pipeline.event.github.pull_request.number`
|The numeric identifier of the pull request.

|`pipeline.event.github.pull_request.merged`
|A boolean that indicates whether the PR was merged or not.
|===

These values are extracted directly from the GitHub event payload. The part after prefix `pipeline.event.github.*` matches the corresponding field in the pull request event structure described in link:https://docs.github.com/en/webhooks/webhook-events-and-payloads#pull_request[the GitHub docs].

**Examples**:

If the trigger option is `PR opened or pushed to, default branch and tag pushes`, include the additional condition `pipeline.event.name == "pull_request"` to prevent the pipeline creation from failing on a `push` event:

[,yaml]
----
workflows:
  say-hello-workflow:
    when: pipeline.event.name == "pull_request" and pipeline.event.github.pull_request.number == 23
    jobs:
      - say-hello
----


To trigger a pipeline on `PR opened or pushed to, default branch and tag pushes`, and ensure that it never runs if the event is associated with a draft PR, use the following:

[,yaml]
----
workflows:
  my-workflow:
    when: pipeline.event.name == "api" or pipeline.event.name == "push" or  (pipeline.event.name == "pull_request" and pipeline.event.github.pull_request.draft == false)
    jobs:
      - myjob
----

* `pipeline.event.github.pull_request.draft == false` excludes draft PRs from triggering the workflow.
* `pipeline.event.name == "api"` ensures that the workflow runs when triggered manually via the web app or API.
* `pipeline.event.name == "push"` ensures that the workflow runs when triggered via push to the default branch.

Config orchestration tools are available from within your pipelines are as follows:

* Use filters to control xref:reference:ROOT:configuration-reference.adoc#using-when-in-workflows[when a workflow will run].
* Use filters to control xref:reference:ROOT:configuration-reference.adoc#expression-based-job-filters[when a job will run].
* Use requires to control xref:reference:ROOT:configuration-reference.adoc#requires[job dependencies within workflows].
* Use filters in steps to control what xref:reference:ROOT:configuration-reference.adoc#the-when-step[work is done within a job].

== Quickstart: Create a trigger to initiate a pipeline when a PR is opened

=== Prerequisites

* A CircleCI account. You can sign up for free at link:https://circleci.com/signup/[circleci.com].
* Your CircleCI account must be linked to a GitHub account, either via xref:integration:github-integration.adoc[GitHub OAuth] or via the xref:integration:github-apps-integration.adoc[CircleCI GitHub App].
* A GitHub App pipeline that you want to trigger when a PR is opened. You can find steps on the xref:pipelines.adoc#add-or-edit-a-pipeline[Pipelines overview and setup] page.

=== Steps

include::guides:ROOT:partial$app-navigation/steps-to-project-settings.adoc[]
+
. Select btn:[GitHub trigger +] at the bottom of the pipeline box.
. Choose "PR Opened" from the *Event* menu. This means that the pipeline will trigger on the `pull_request` GitHub event with the `opened` action (See the link:https://docs.github.com/en/webhooks/webhook-events-and-payloads?actionType=opened#pull_request[GitHub docs webhooks page] for more information).
+
.Trigger options under Project settings
image::guides:ROOT:triggers/select-when-to-run.png[Set a trigger option for a project trigger]
.
** Select the *Event Source* repository from the dropdown. This defaults to the config source repository. If you change it to a repository that does not match the pipeline's checkout source, you can specify a branch to be used for fetching config and code checkout.
. Select btn:[Save].

To verify your trigger is set up correctly, trigger an event (open a PR) from your repository.

== FAQs

=== Can I combine multiple trigger options?

No, different trigger event options cannot be combined in a single trigger. However, you can create multiple triggers for the same pipeline that listen for events from the same repository, with each trigger using a different trigger event option.

For example, by having the following:

* One trigger with the trigger option "PR opened"
* One trigger with the trigger option "PR merged"

Your pipeline will trigger whenever a PR is opened or merged.

== Next steps

For more examples of using GitHub App trigger options, see the xref:orchestration-cookbook.adoc[Orchestration cookbook].
